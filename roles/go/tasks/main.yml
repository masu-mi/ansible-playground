---
- block:
    - name: mkdir dev as $GOPATH
      file:
        path: "{{ item }}"
        state: directory
      with_items:
        [
         "{{ gopath }}",
         "{{ gopath }}/bin",
         "{{ gopath }}/src",
        ]
    - name: create bootstrap go dir(e.g. go1.4)
      file: path={{ go_boot_root }} state=directory
    - name: deploy bootstrap go
      shell: wget -O - https://storage.googleapis.com/golang/go{{ go_boot_version }}.{{ go_target_arch }}.tar.gz | tar -zxvf - --directory={{ go_boot_root }} --strip-components 1
      args:
        creates: '{{ go_boot_root }}/bin/go'
    - name: prepare to install Go
      git: repo=https://go.googlesource.com/go dest={{ goroot }} version=go{{ go_version }}
    - name: install Go
      shell: |
        export GOROOT_BOOTSTRAP={{ go_boot_root }}
        ./all.bash
      args:
        chdir: '{{ goroot }}/src'
        creates: '{{ goroot }}/bin/go'
    - name: install glide
      shell: |
        curl https://glide.sh/get | sh
      args:
        creates: "{{ gopath }}/bin/glide"
    - name: install tools
      shell: |
        GOPATH={{ gopath }} {{ goroot }}/bin/go get "{{ item }}"
      with_items:
        [
          "github.com/derekparker/delve/cmd/dlv",
          "github.com/peco/peco/cmd/peco",
          "github.com/motemen/ghq",
          "github.com/direnv/direnv",
        ]
  become: yes
  become_user: "{{ user }}"
